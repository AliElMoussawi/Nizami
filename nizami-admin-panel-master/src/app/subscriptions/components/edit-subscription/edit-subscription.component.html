<app-template>
  <div class="flex flex-col gap-9 pt-8 pb-24 pr-2 w-full h-full overflow-auto">
    <div class="flex flex-row justify-between items-center">
      <div class="text-3xl font-bold">
        Edit Subscription
      </div>
    </div>

    @if (subscription) {
      <div class="max-w-4xl">
        <!-- Subscription Info -->
        <div class="bg-gray-50 p-4 rounded-lg mb-6">
          <h3 class="text-lg font-medium text-gray-900 mb-2">Subscription Details</h3>
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <span class="font-medium text-gray-500">User:</span>
              <span class="ml-2">{{ subscription.user.first_name }} {{ subscription.user.last_name }}</span>
            </div>
            <div>
              <span class="font-medium text-gray-500">Email:</span>
              <span class="ml-2">{{ subscription.user.email }}</span>
            </div>
            <div>
              <span class="font-medium text-gray-500">Plan:</span>
              <span class="ml-2">{{ subscription.plan.name }}</span>
            </div>
            <div>
              <span class="font-medium text-gray-500">UUID:</span>
              <span class="ml-2 font-mono text-xs">{{ subscription.uuid }}</span>
            </div>
          </div>
        </div>

        <form [formGroup]="subscriptionForm" (ngSubmit)="onSubmit()" class="space-y-6">
          <div class="bg-white p-6 rounded-xl border-2 border-grey9">
            <div class="space-y-6">
              
              <!-- Active Status -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Status <span class="text-red-500">*</span>
                </label>
                <select
                  formControlName="is_active"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  [class.border-red-500]="subscriptionForm.get('is_active')?.invalid && subscriptionForm.get('is_active')?.touched"
                >
                  <option [value]="true">Active</option>
                  <option [value]="false">Inactive</option>
                </select>
                @if (getFieldError('is_active')) {
                  <p class="mt-1 text-sm text-red-600">{{ getFieldError('is_active') }}</p>
                }
              </div>

              <!-- Credit Type -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Credit Type <span class="text-red-500">*</span>
                </label>
                <select
                  formControlName="credit_type"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  [class.border-red-500]="subscriptionForm.get('credit_type')?.invalid && subscriptionForm.get('credit_type')?.touched"
                >
                  <option value="MESSAGES">Messages</option>
                </select>
                @if (getFieldError('credit_type')) {
                  <p class="mt-1 text-sm text-red-600">{{ getFieldError('credit_type') }}</p>
                }
              </div>

              <!-- Unlimited Credits -->
              <div class="flex items-center">
                <input
                  type="checkbox"
                  formControlName="is_unlimited"
                  id="is_unlimited"
                  class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                >
                <label for="is_unlimited" class="ml-2 block text-sm text-gray-700">
                  Unlimited credits
                </label>
              </div>

              <!-- Credit Amount -->
              <div [class.hidden]="subscriptionForm.get('is_unlimited')?.value">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Credit Amount <span class="text-red-500">*</span>
                </label>
                <app-input
                  formControlName="credit_amount"
                  type="number"
                  placeholder="Enter credit amount"
                  [class.border-red-500]="subscriptionForm.get('credit_amount')?.invalid && subscriptionForm.get('credit_amount')?.touched"
                ></app-input>
                @if (getFieldError('credit_amount')) {
                  <p class="mt-1 text-sm text-red-600">{{ getFieldError('credit_amount') }}</p>
                }
              </div>

              <!-- Expiry Date -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Expiry Date <span class="text-red-500">*</span>
                </label>
                <app-input
                  formControlName="expiry_date"
                  type="datetime-local"
                  [class.border-red-500]="subscriptionForm.get('expiry_date')?.invalid && subscriptionForm.get('expiry_date')?.touched"
                ></app-input>
                @if (getFieldError('expiry_date')) {
                  <p class="mt-1 text-sm text-red-600">{{ getFieldError('expiry_date') }}</p>
                }
              </div>

            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex justify-end space-x-4">
            <app-flat-button
              type="button"
              (onClick)="onCancel()"
              [disabled]="isLoading"
            >
              Cancel
            </app-flat-button>
            
            <app-button
              type="submit"
              [disabled]="subscriptionForm.invalid || isLoading"
            >
              Update Subscription
            </app-button>
          </div>
        </form>
      </div>
    } @else if (isLoading) {
      <div class="flex justify-center items-center py-12">
        <div class="text-gray-500">Loading subscription details...</div>
      </div>
    } @else {
      <div class="flex justify-center items-center py-12">
        <div class="text-red-500">Subscription not found</div>
      </div>
    }
  </div>
</app-template>
