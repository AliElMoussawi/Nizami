<app-template>
  <div class="flex flex-col gap-9 pt-8 pb-24 pr-2 w-full h-full overflow-auto">
    <div class="flex flex-row justify-between items-center">
      <div class="text-3xl font-bold">
        Users List
      </div>

      <div>
        <a routerLink="/users/create"
           class="
px-4 py-2.5 disabled:bg-grey3 rounded-lg disabled:text-white w-full
bg-blue1 text-white text-base font-medium disabled:cursor-not-allowed hover:bg-purple5
shadow-[0px_1px_2px_0px_#1018280D]
flex flex-row gap-2 items-center justify-center
"
        >
          <img src="/assets/icons/circle-plus.svg" alt="New">
          <span>Create new user</span>
        </a>
      </div>
    </div>

    <div class="table-section">
      <div class="border-2 border-grey9 rounded-xl">

        <div class="flex flex-row justify-between px-4 py-3  border-b-2 border-grey9">
          <div class="flex flex-row gap-2 items-center">
            <span class="text-sm">Quick Filters</span>
            <app-filter-tag
              [isActive]="statusFilter() == 'inactive'"
              (onClick)="filterClicked('inactive')"
            >
              Blocked
            </app-filter-tag>

            <app-filter-tag
              [isActive]="statusFilter() == 'active'"
              (onClick)="filterClicked('active')"
            >
              Active
            </app-filter-tag>
          </div>
          <div>
            <app-input
              [(ngModel)]="searchText"
              (ngModelChange)="onChange($event)"
              placeholder="Search"
              (keyup.enter)="onSearch()"
            >
              <button class="icon-before pl-3 flex items-center" type="button">
                <img src="/assets/icons/magnifying-glass.svg" alt="Search">
              </button>
            </app-input>
          </div>
        </div>

        <table
          [dtOptions]="dtOptions"
          [dtTrigger]="dtTrigger"
          class="table table-striped table-row-bordered hover gy-5 gs-7 w-full text-left"
          datatable
        ></table>
      </div>
    </div>
  </div>
</app-template>

<ng-template #profileImage let-data="adtData">
  <app-profile-image
    [imageUrl]="data.profile_image"
    [firstName]="data.first_name"
    [lastName]="data.last_name"
  ></app-profile-image>
</ng-template>

<ng-template #status let-data="adtData">
  <app-user-status
    [isActive]="data.is_active == true"
  ></app-user-status>
</ng-template>

<ng-template #actions let-data="adtData" let-select="select">
  <app-actions
    #actionsComponent
    class="flex py-4"
    [showSelect]="false"
    [editRouterLink]="['/users', data.id, 'edit']"
    [showDelete]="true"
    (onDelete)="deleteUser(data)"
  >
    <ng-container class="after">
      @if (data.is_active) {
        <button mat-menu-item (click)="toggleUserStatus(data, false)">
          <img src="/assets/icons/block.svg" alt="Block">
          <span>Block</span>
        </button>
      } @else {
        <button mat-menu-item (click)="toggleUserStatus(data, true)">
          <img src="/assets/icons/block.svg" alt="Unblock">
          <span>Unblock</span>
        </button>
      }

      <button mat-menu-item (click)="resetPassword(data)">
        <img src="/assets/icons/replay.svg" alt="Reset password">
        <span>Reset password</span>
      </button>
    </ng-container>
  </app-actions>
</ng-template>
