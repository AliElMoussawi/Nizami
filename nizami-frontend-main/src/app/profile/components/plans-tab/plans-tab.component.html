<div class="flex flex-col gap-8">
  <!-- Loading -->
  @if (loading) {
    <app-spinner></app-spinner>
  }

  <!-- Error -->
  @if (error && !loading) {
    <div class="bg-red1 border border-red2 rounded-lg p-4">
      <app-error>
        {{ error }}
      </app-error>
    </div>
  }

  <!-- Plans grid -->
  @if (!loading && !error && plans.length > 0) {
    <div class="w-full flex flex-col gap-8">
      <div class="flex flex-col xl:flex-row">
        <div class="min-w-full xl:min-w-36 text-grey6 font-bold text-sm">
          {{ 'available_plans' | translate }}
        </div>
        <div class="text-grey5 text-sm font-normal">
          {{ 'choose_plan_description' | translate }}
        </div>
      </div>

      <hr class="text-grey1 -mx-7 xl:mx-0">

      <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
        @for (plan of plans; track plan.uuid) {
          <div 
            class="bg-white border border-grey1 rounded-lg p-6 hover:shadow-[0px_1px_2px_0px_#1018280D] transition-shadow cursor-pointer"
            (click)="selectPlan(plan)"
          >
            <div class="flex flex-col h-full gap-4">
              <!-- Header -->
              <div class="flex flex-row justify-between items-start">
                <div class="flex flex-col gap-2">
                  <h3 class="text-lg font-bold text-grey6">{{ plan.name }}</h3>
                  <span class="inline-block px-2 py-1 bg-purple2 text-blue1 text-xs font-semibold rounded">
                    {{ plan.tier }}
                  </span>
                </div>
              </div>

              <!-- Description -->
              <p class="text-grey5 text-sm flex-grow">
                {{ plan.description }}
              </p>

              <!-- Pricing -->
              <div class="border-t border-grey1 pt-4 flex flex-col gap-4">
                <div class="flex flex-row justify-between items-baseline">
                  <span class="text-3xl font-bold text-grey6">
                    {{ formatPrice(plan.price_cents, plan.currency) }}
                  </span>
                  @if (plan.interval_unit) {
                    <span class="text-sm text-grey5">
                      {{ getIntervalText(plan.interval_unit, plan.interval_count) }}
                    </span>
                  }
                </div>

                <!-- Features -->
                <div class="flex flex-col gap-2 text-sm text-grey6">
                  @if (plan.is_unlimited) {
                    <div class="flex flex-row gap-2 items-center">
                      <span class="text-blue1">✓</span>
                      <span>{{ 'unlimited_credits' | translate }}</span>
                    </div>
                  }
                  @if (!plan.is_unlimited && plan.credit_amount) {
                    <div class="flex flex-row gap-2 items-center">
                      <span class="text-blue1">✓</span>
                      <span>{{ plan.credit_amount }} {{ plan.credit_type | lowercase }}</span>
                    </div>
                  }
                  @if (plan.rollover_allowed) {
                    <div class="flex flex-row gap-2 items-center">
                      <span class="text-blue1">✓</span>
                      <span>{{ 'rollover_allowed' | translate }}</span>
                    </div>
                  }
                </div>

                <!-- Subscribe Button -->
                <app-button type="button">
                  {{ 'subscribe' | translate }}
                </app-button>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- No plans -->
  @if (!loading && !error && plans.length === 0) {
    <div class="text-center py-8 text-grey5 text-sm">
      {{ 'no_plans_available' | translate }}
    </div>
  }

  <hr class="text-grey1 -mx-7 xl:mx-0">

  <span class="flex-1 hidden xl:block"></span>

  <div class="flex flex-row self-end gap-2 xl:gap-4 mb-1">
    <app-outline-button
      (onClick)="onCancel.emit()"
      type="button"
    >
      {{ 'close' | translate }}
    </app-outline-button>
  </div>
</div>
